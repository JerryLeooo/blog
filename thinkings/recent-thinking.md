# 实战中的系统方案设计及反思

新来的实习生小鲜肉在测试API的时候错误使用了线上的地址，结果全站有8万多用户都收到了内容为“测试”的私信。CTO当机立断指挥我删掉了那些状态为未读的私信，尽可能减少损失。

故事还没完，后来我们发现虽然私信删掉了，但是提醒却没有删掉。想象下，页面上总是弹着一个提醒，而点它的时候却什么都没有，也是蛮心酸的。所以提醒还是要删。然后我就和CTO在琢磨删除提醒的脚本怎么写。先来看看一些类的定义：

<!--more-->
```
class Reminder:
    ...
    descripter # like message:1231234
    ...

class Message:
    ...

```

因为是去删除Reminder，所以一开始我的思路就集中在了Reminder上，心里的思路就是遍历所有Reminder来判断其信息是不是已经删掉，这个想法很快就被否决了，因为全站私信数目太多，这样遍历一遍未免太慢。

直接上CTO的解决方案吧，很巧妙：

首先找到刚才所删私信的大致范围，然后设置一个计数器，使其等于这个区间的左端点，然后开始将计数器开始自增。计数器代表的数字就是私信ID，如果和这个ID还在，证明私信没有被删，如果此ID不在证明私信已经被删掉了，那么就要将其对应的Reminder删掉。

巧妙之处就在于，虽然是去删除Reminder，但是绕到Message上面去判断，因为Message和Reminder是一一对应的。

关于自己为什么没想到，大概还是有一些原因：

1.  对于Python和SQL还是没有熟到手到擒来的地步，所以思考的时候重点偏向了具体的代码怎么写，而不是一个更好的solution。
2.  没有注意到Message和Reminder一一对应，所以舍近求远。

趁着这个，反思了这一年的成长，发现还是慢，很大的原因就是遇到了问题没有及时去弄明白，也没有及时去总结，失去了很多很好的成长机会。比如写这个的时候还不清楚 `psycopg2` 中 `cursor.fetchall()` 的返回值定义是啥，每次用的时候都需要打印出来才继续写脚本。所以按照这个[程序员成长历程的四个阶段](http://news.html5tricks.com/4-level-of-programmer.html) 来看，我应该已经到第二阶段了吧。

我想以后的成长之路应该是更加及时地去把该弄明白的弄明白，该记下来的记下来。所以用 `daily.page7.me` 在SAE上托管了一个静态页面，每天争取写一点，通过总结，将接受到的信息都转化为自己的知识，为自己建立一个更好的知识管理模型。


That's all.
